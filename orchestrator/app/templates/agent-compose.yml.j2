# Agent Docker Compose Template
# Generated by kanban orchestrator for sandbox: {{ agent_id }}

services:
  kanban-agent:
    image: {{ kanban_agents_image }}
    container_name: {{ container_name }}
    restart: unless-stopped
    volumes:
      # Mount the target project the agent will work on
      - {{ target_project_path }}:/app/target-project:rw
      # Mount Claude CLI credentials (for Pro subscription) if available
      - ${HOME}/.claude:/root/.claude:ro
      # Mount SSH key for host command execution
      - ${HOME}/.ssh/id_ed25519:/root/.ssh/id_ed25519:ro
    environment:
      # Kanban API settings
      - KANBAN_API_URL={{ kanban_api_url }}
      - KANBAN_WEBHOOK_SECRET={{ webhook_secret }}

      # Git branch for this sandbox
      - GIT_BRANCH={{ sandbox_branch }}

      # LLM settings
      - LLM_PROVIDER={{ llm_provider }}
      - LLM_MODEL={{ llm_model }}
      - OLLAMA_BASE_URL={{ ollama_base_url }}

      # Target project path inside container
      - TARGET_PROJECT_PATH=/app/target-project

      # Server settings
      - HOST=0.0.0.0
      - PORT=8001
      - DEBUG=${DEBUG:-false}

      # SSH settings for host command execution
      - SSH_ENABLED=${SSH_ENABLED:-true}
      - SSH_HOST=${SSH_HOST:-host.docker.internal}
      - SSH_PORT=${SSH_PORT:-22}
      - SSH_USER=${SSH_USER}
      - SSH_KEY_PATH=/root/.ssh/id_ed25519
    labels:
      - "kanban.type=sandbox-agent"
      - "kanban.agent.id={{ agent_id }}"
      - "kanban.workspace={{ workspace_slug }}"
      - "kanban.sandbox={{ sandbox_slug }}"
      - "kanban.branch={{ sandbox_branch }}"
    networks:
      - {{ network_name }}

networks:
  {{ network_name }}:
    external: true
